# chapter 14   浏览器网络概述

## 14.1  连接管理与优化

套接字是以池的形式进行管理的(图 14-2 )， 即按照来源,每个池都有自己的连接限制和安全约束。挂起的请求是排好队的、有优先次序的,然后再适时把它们绑定到池中个
别的套接字上。除非服务器有意关闭连接,否则同一个套接字可以自动用于多个请求!

  • 来源
    由应用协议、域名和端口三个要件构成,比如 (http, www.example.com, 80) 与 (https, www.example.com, 443) 就是两个不同的来源。
  • 套接字池
    属于同一个来源的一组套接字。实践中,所有主流浏览器的最大池规模都是 6 个套接字。
    
    
## 14.2 网络安全与沙箱

将个别套接字的管理任务委托给浏览器还有另一个重要的用意:可以让浏览器运用沙箱机制,对不受信任的应用代码采取一致的安全与策略限制。比如,浏览器不允许直接访问原始网络套接字 API,因为这样给恶意应用向任意主机发起任意请求
(端口扫描、连接邮件服务器或发送未知消息)提供可乘之机。

  • 连接限制
    浏览器管理所有打开的套接字池并强制施加连接数限制,保护客户端和服务器的资源不会被耗尽。
    
  • 请求格式化与响应处理
    浏览器格式化所有外发请求以保证格式一致和符合协议的语义,从而保护服务器。类似地,响应解码也会自动完成,以保护用户。
    
  • TLS 协商
    浏览器执行 TLS 握手和必要的证书检查。任何证书有问题(比如服务器正在使用自已签发的证书),用户都会收到通知。
    
  • 同源策略
    浏览器会限制应用只能向哪个来源发送请求。
    
    
  
## 14.3  资源与客户端状态缓存

最后,浏览器还有一个经常被人忽视的重要功能,  那就是提供会话认证和 cookie 管理。浏览器为每个来源维护着独立的 cookie 容器,为读写新 cookie、会话和认证数据提供必要的应用及服务器 API,还会为我们自动追加和处理 HTTP 首部,让一切都自动化。

举一个简单但直观的例子,它能说明把会话状态管理委托给浏览器的好处:认证的会话可以在多个标签页或浏览器口间共享,反之亦然;如果用户在某个标签页中退出,那么其他所有打开窗口中的会话都将失效。



## 14.4  应用 API 与协议

不存在哪个协议或API最好的问题。每个稍微复杂点的应用都会基于不同的 需求用到各种传输机制,包括读写浏览器缓存、协议开销、消息延迟、可靠性、数据 传 输 类 型, 等 等。某 些 协 议 的 交 付 延 迟 可 能 短 一 些( 比 如 Server-Sent Events、WebSocket),但却不能满足其他条件,比如利用浏览器缓存,或者在所有场景下支
持高效的二进制传输(表 14-1)。

我们在这个表中有意忽略了 WebRTC,因为那是一种端到端的交付模型,与 XHR、SSE 和 WebSocket 协议有着根本的不同。

理解了每种协议的长处和短处,根据应用的需求恰当运用它们,就可以摆脱贫乏的用户体验,打造出高性能应用。

Web Real-Time Communication(Web 实时通信,WebRTC)由一组标准、协议和JavaScript API 组成,用于实现浏览器之间(端到端)的音频、视频及数据共享。WebRTC 使得实时通信变成一种标准功能,任何 Web 应用都无需借助第三方插件和
专有软件,而是通过简单的 JavaScript API 即可利用。
